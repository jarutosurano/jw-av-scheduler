---
import Layout from '../layouts/Layout.astro';
import {
  getAvailableMonths,
  formatMonthDisplay,
} from '../lib/schedules';

const months = getAvailableMonths();
const baseUrl = import.meta.env.BASE_URL || '/';
---

<Layout title="Dashboard">
  <div class="container">
    <!-- Welcome Section -->
    <header class="welcome-section">
      <h1 class="welcome-title">AV Scheduler</h1>
      <p class="welcome-subtitle">Victoria Tagalog Congregation, Kitchener, ON</p>
      <p class="welcome-desc">
        An automated scheduling system for Audio/Video assignments during congregation meetings.
        This tool helps ensure fair rotation of brothers while respecting constraints and availability.
      </p>
    </header>

    <div class="content-grid">
      <!-- How It Works -->
      <section class="card">
        <h2 class="section-title">How It Works</h2>
        <div class="logic-grid">
          <div class="logic-item">
            <div class="logic-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
            </div>
            <h3>Fair Rotation</h3>
            <p>Brothers are assigned based on how recently they served. Those who haven't been assigned recently get priority.</p>
          </div>

          <div class="logic-item">
            <div class="logic-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
            </div>
            <h3>Availability Check</h3>
            <p>The system reads meeting parts from Hourglass PDFs and automatically excludes brothers who have speaking assignments.</p>
          </div>

          <div class="logic-item">
            <div class="logic-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
              </svg>
            </div>
            <h3>Privilege-Based</h3>
            <p>Certain positions (Audio, Video) are restricted to qualified brothers. Mic and attendant positions are open to all approved brothers.</p>
          </div>

          <div class="logic-item">
            <div class="logic-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="12" x2="16" y2="14"></line>
              </svg>
            </div>
            <h3>Same Team Policy</h3>
            <p>The same team serves both Friday (midweek) and Sunday (weekend) meetings for consistency.</p>
          </div>
        </div>
      </section>

      <!-- Positions -->
      <section class="card">
        <h2 class="section-title">AV Positions (9 Total)</h2>
        <div class="positions-grid">
          <div class="position-group">
            <h3>Booth</h3>
            <ul>
              <li><strong>Audio</strong> - Sound mixing console</li>
              <li><strong>Video</strong> - Camera & video switching</li>
              <li><strong>A/V Assistant</strong> - Support for audio/video</li>
            </ul>
          </div>
          <div class="position-group">
            <h3>Microphones</h3>
            <ul>
              <li><strong>Right Mic</strong> - Right side roving mic</li>
              <li><strong>Left Mic</strong> - Left side roving mic</li>
            </ul>
          </div>
          <div class="position-group">
            <h3>Attendants</h3>
            <ul>
              <li><strong>Front/Stage</strong> - Platform area</li>
              <li><strong>Auditorium</strong> - Main seating area</li>
              <li><strong>Entrance 1</strong> - Main entrance</li>
              <li><strong>Entrance 2</strong> - Secondary entrance</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Generate New Schedule -->
      <section class="card generate-section">
        <h2 class="section-title">Generate New Schedule</h2>

        <div class="setup-instructions">
          <div class="setup-notice">
            <svg class="notice-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="16" x2="12" y2="12"/>
              <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            <p>To generate new schedules, you need to run the app locally. Follow the steps below to set up your local environment.</p>
          </div>

          <h3 class="setup-title">Local Setup Instructions</h3>
          <ol class="setup-steps">
            <li>
              <strong>Clone the repository</strong>
              <code class="cli-command">git clone https://github.com/jarutosurano/jw-av-scheduler.git</code>
            </li>
            <li>
              <strong>Navigate to the project folder</strong>
              <code class="cli-command">cd jw-av-scheduler</code>
            </li>
            <li>
              <strong>Install dependencies</strong>
              <code class="cli-command">pnpm install</code>
            </li>
            <li>
              <strong>Download PDFs from Hourglass</strong>
              <p class="step-note">Export the midweek and weekend meeting schedules as PDF files.</p>
            </li>
            <li>
              <strong>Generate the schedule</strong>
              <code class="cli-command">pnpm generate --pdf midweek.pdf --pdf weekend.pdf --month 2026-05</code>
            </li>
            <li>
              <strong>Preview locally (optional)</strong>
              <code class="cli-command">pnpm dev</code>
              <p class="step-note">Open <code>http://localhost:4321/jw-av-scheduler</code> to preview.</p>
            </li>
            <li>
              <strong>Commit and push to deploy</strong>
              <code class="cli-command">git add . && git commit -m "Add schedule for May 2026" && git push</code>
              <p class="step-note">GitHub Actions will automatically deploy to GitHub Pages.</p>
            </li>
          </ol>

          <div class="setup-alternative">
            <h4>CLI Options Reference</h4>
            <p>The generator supports several options for special weeks:</p>
            <ul class="cli-options">
              <li><code>--note DATE:TEXT</code> - Add a note (e.g., <code>--note 2026-04-03:Memorial</code>)</li>
              <li><code>--weekend-only DATE</code> - Mark week as weekend-only (no midweek meeting)</li>
              <li><code>--no-meeting DATE</code> - Mark week with no meetings (Circuit Assembly)</li>
              <li><code>--preview</code> - Preview without saving files</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Available Schedules -->
      <section class="card">
        <h2 class="section-title">Available Schedules</h2>
        {months.length > 0 ? (
          <div class="schedules-grid">
            {months.map((month) => (
              <a href={`${baseUrl.endsWith('/') ? baseUrl : baseUrl + '/'}schedule/${month}`} class="schedule-card">
                <span class="schedule-month">{formatMonthDisplay(month)}</span>
                <svg class="schedule-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </a>
            ))}
          </div>
        ) : (
          <p class="no-schedules">No schedules generated yet. Use the CLI to create your first schedule.</p>
        )}
      </section>

      <!-- Meeting Times -->
      <section class="card info-card">
        <h2 class="section-title">Meeting Schedule</h2>
        <div class="meeting-times">
          <div class="meeting">
            <span class="meeting-day">Friday</span>
            <span class="meeting-type">Midweek Meeting</span>
          </div>
          <div class="meeting">
            <span class="meeting-day">Sunday</span>
            <span class="meeting-type">Weekend Meeting</span>
          </div>
        </div>
      </section>
    </div>
  </div>
</Layout>

<style>
  .container {
    max-width: 900px;
  }

  /* Welcome Section */
  .welcome-section {
    text-align: center;
    margin-bottom: 2.5rem;
  }

  .welcome-title {
    font-size: 2.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
  }

  .welcome-subtitle {
    font-size: 1rem;
    color: var(--primary-color);
    font-weight: 500;
    margin-bottom: 1rem;
  }

  .welcome-desc {
    font-size: 1rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Content Grid */
  .content-grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 1.5rem;
    transition: background-color 0.2s ease, border-color 0.2s ease;
  }

  .section-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 1.25rem;
  }

  /* Logic Grid */
  .logic-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  .logic-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .logic-icon {
    width: 40px;
    height: 40px;
    background: var(--primary-bg);
    border-radius: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
  }

  .logic-icon svg {
    width: 20px;
    height: 20px;
  }

  .logic-item h3 {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
  }

  .logic-item p {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    line-height: 1.5;
    margin: 0;
  }

  /* Positions Grid */
  .positions-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  .position-group h3 {
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--primary-color);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.75rem;
  }

  .position-group ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .position-group li {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    padding: 0.375rem 0;
    border-bottom: 1px solid var(--border-color);
  }

  .position-group li:last-child {
    border-bottom: none;
  }

  .position-group li strong {
    color: var(--text-primary);
    font-weight: 500;
  }

  /* CLI Command */
  .cli-command {
    display: block;
    background: #1e293b;
    color: #4ade80;
    padding: 0.75rem 1rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
    margin-top: 0.75rem;
    overflow-x: auto;
  }

  /* Schedules Grid */
  .schedules-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 0.75rem;
  }

  .schedule-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    background: var(--hover-bg);
    border-radius: 0.5rem;
    text-decoration: none;
    color: var(--text-primary);
    font-weight: 500;
    transition: all 0.15s ease;
  }

  .schedule-card:hover {
    background: var(--primary-bg);
    color: var(--primary-color);
  }

  .schedule-arrow {
    width: 18px;
    height: 18px;
    opacity: 0.5;
  }

  .schedule-card:hover .schedule-arrow {
    opacity: 1;
    transform: translateX(2px);
  }

  .no-schedules {
    color: var(--text-secondary);
    font-size: 0.875rem;
    text-align: center;
    padding: 1rem;
  }

  /* Meeting Times */
  .info-card {
    background: var(--primary-bg);
    border-color: transparent;
  }

  .info-card .section-title {
    color: var(--primary-color);
  }

  .meeting-times {
    display: flex;
    gap: 2rem;
  }

  .meeting {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .meeting-day {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .meeting-type {
    font-size: 0.8125rem;
    color: var(--text-secondary);
  }

  /* Generate Section */
  .generate-section {
    border: 2px solid var(--primary-color);
  }

  /* Setup Instructions */
  .setup-notice {
    display: flex;
    gap: 0.75rem;
    padding: 1rem;
    background: #fef3c7;
    border: 1px solid #fcd34d;
    border-radius: 0.375rem;
    margin-bottom: 1.5rem;
  }

  .dark .setup-notice {
    background: #422006;
    border-color: #92400e;
  }

  .notice-icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    color: #b45309;
  }

  .dark .notice-icon {
    color: #fbbf24;
  }

  .setup-notice p {
    font-size: 0.875rem;
    color: #92400e;
    margin: 0;
    line-height: 1.5;
  }

  .dark .setup-notice p {
    color: #fcd34d;
  }

  .setup-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 1rem;
  }

  .setup-steps {
    list-style: none;
    padding: 0;
    margin: 0 0 1.5rem 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .setup-steps li {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .setup-steps li strong {
    font-size: 0.875rem;
    color: var(--text-primary);
  }

  .setup-steps .step-note {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin: 0;
  }

  .setup-steps .step-note code {
    background: var(--hover-bg);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
  }

  .setup-alternative {
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
  }

  .setup-alternative h4 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 0.5rem 0;
  }

  .setup-alternative p {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin: 0 0 0.75rem 0;
  }

  .cli-options {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .cli-options li {
    font-size: 0.8125rem;
    color: var(--text-secondary);
  }

  .cli-options code {
    background: var(--hover-bg);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    color: var(--text-primary);
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .welcome-title {
      font-size: 1.75rem;
    }

    .logic-grid {
      grid-template-columns: 1fr;
    }

    .positions-grid {
      grid-template-columns: 1fr;
    }

    .meeting-times {
      flex-direction: column;
      gap: 1rem;
    }

    .schedules-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
